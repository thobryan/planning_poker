{% extends "poker/base.html" %}
{% block content %}
<div class="mx-auto max-w-3xl">
  <section class="rounded-3xl border border-white/15 bg-white/5 p-8 shadow-2xl shadow-brand/10 backdrop-blur">
    <div class="grid gap-8 md:grid-cols-2">
      <div>
        <p class="text-sm uppercase tracking-[0.4em] text-brand-light">Welltech teams</p>
        <h2 class="mt-3 text-3xl font-semibold text-white">Secure access only.</h2>
        <p class="mt-2 text-base text-slate-200">
          Planning Poker is limited to teammates with a <strong>@{{ allowed_domain }}</strong> email.
          Enter your address and we'll email you a 6-digit code to confirm it's really you.
        </p>
        <ul class="mt-6 space-y-3 text-sm text-slate-200/90">
          <li class="flex items-start gap-2">
            <span class="mt-1 size-2 rounded-full bg-emerald-400"></span>
            Instant access — no passwords to remember.
          </li>
          <li class="flex items-start gap-2">
            <span class="mt-1 size-2 rounded-full bg-emerald-400"></span>
            Session scoped: we only store your room presence locally.
          </li>
          <li class="flex items-start gap-2">
            <span class="mt-1 size-2 rounded-full bg-emerald-400"></span>
            Switch teams any time — just sign out when you are done.
          </li>
        </ul>
      </div>

      <div class="rounded-2xl bg-white/95 p-6 shadow-xl">
        {% if token_required %}
          <p class="mb-4 rounded-xl bg-emerald-50 px-4 py-3 text-sm text-emerald-800">
            We sent a code to <strong>{{ pending_email }}</strong>. Enter it below to continue.
          </p>
        {% endif %}
        <form method="post" class="space-y-4">
          {% csrf_token %}
          <input type="hidden" name="next" value="{{ next_param }}">
          <label class="space-y-2 text-sm font-medium text-slate-700">
            Your work email
            {{ form.email }}
            {% for error in form.email.errors %}
              <p class="text-sm text-red-600">{{ error }}</p>
            {% endfor %}
          </label>
          {% if token_required %}
            <div class="text-xs text-slate-500">
              Not you? <a class="text-brand hover:underline" href="{% url 'poker:org_login' %}{% if next_param %}?next={{ next_param|urlencode }}&reset_token=1{% else %}?reset_token=1{% endif %}">Use a different email</a>
            </div>
            <label class="space-y-2 text-sm font-medium text-slate-700">
              Verification code
              {{ form.token }}
              {% for error in form.token.errors %}
                <p class="text-sm text-red-600">{{ error }}</p>
              {% endfor %}
            </label>
            <p class="text-xs text-slate-500">Codes expire in {{ token_expires_minutes }} minute(s).</p>
          {% endif %}
          {% if form.non_field_errors %}
            <p class="text-sm text-red-600">{{ form.non_field_errors|join:", " }}</p>
          {% endif %}
          {% if token_required %}
            <div class="space-y-3">
              <button class="w-full rounded-2xl bg-brand px-4 py-2.5 text-base font-semibold text-white shadow-lg shadow-brand/40 transition hover:bg-brand-dark">
                Verify & enter the workspace
              </button>
              <button name="action" value="resend" class="w-full rounded-2xl border border-brand px-4 py-2.5 text-base font-semibold text-brand transition hover:bg-brand/5">
                Resend code
              </button>
            </div>
          {% else %}
            <button class="w-full rounded-2xl bg-brand px-4 py-2.5 text-base font-semibold text-white shadow-lg shadow-brand/40 transition hover:bg-brand-dark">
              Email me a login code
            </button>
          {% endif %}
        </form>
        <p class="mt-4 text-xs text-slate-500">Need help? Ping #platform or reach infra@welltech.com.</p>
      </div>
    </div>
  </section>
</div>
{% endblock %}
